<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#001a4d">
    <title>Checklist Porto Mais</title>
    
    <style>
        /* --- ESTILOS VISUAIS --- */
        :root { --primary: #001a4d; --secondary: #003380; --accent: #e63946; --bg: #f4f6f9; --surface: #ffffff; --text: #333; --border: #e0e0e0; --success: #28a745; }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: sans-serif; background-color: var(--bg); color: var(--text); padding: 15px; line-height: 1.4; }
        
        .container { max-width: 800px; margin: 0 auto; background: var(--surface); padding: 25px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        
        /* Cabe√ßalho */
        .header { text-align: center; border-bottom: 2px solid var(--primary); padding-bottom: 20px; margin-bottom: 25px; }
        .logo-img { max-width: 180px; height: auto; margin: 0 auto 8px; display: block; }
        .header-subtitle { font-size: 13px; color: #666; font-weight: 700; text-transform: uppercase; }

        /* Inputs de Topo */
        .info-header { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 12px; margin-bottom: 25px; }
        .info-item { background: #f8f9fb; padding: 8px 12px; border-radius: 8px; border-left: 4px solid var(--primary); }
        .info-item label { display: block; font-size: 10px; font-weight: 700; color: var(--primary); text-transform: uppercase; }
        .info-item input { width: 100%; border: none; background: transparent; font-weight: 600; font-size: 14px; outline: none; }

        /* Se√ß√µes */
        .section { margin-bottom: 20px; }
        .section-title { background: var(--primary); color: white; padding: 10px 15px; font-size: 13px; font-weight: 600; border-radius: 8px 8px 0 0; text-transform: uppercase; }
        .section-content { border: 1px solid var(--border); border-top: none; border-radius: 0 0 8px 8px; padding: 15px; background: #fff; }

        /* Formul√°rios */
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .form-group { display: flex; flex-direction: column; }
        .form-group label { font-size: 11px; font-weight: 600; color: #555; margin-bottom: 5px; }
        .form-group input, .form-group select { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 13px; outline: none; width: 100%; }
        .form-group input:focus { border-color: var(--primary); }

        /* Checkbox e Radio */
        .checkbox-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 8px; }
        .checkbox-item { display: flex; align-items: center; font-size: 12px; background: #f8f9fa; padding: 10px; border-radius: 6px; cursor: pointer; }
        .checkbox-item input { margin-right: 8px; transform: scale(1.2); }
        .radio-group { display: flex; gap: 15px; }
        .radio-label { display: flex; align-items: center; font-size: 12px; cursor: pointer; }
        .radio-label input { margin-right: 5px; }

        /* Assinatura */
        .signature-wrapper { position: relative; width: 100%; height: 180px; border: 2px dashed #bbb; background: #fafafa; border-radius: 8px; touch-action: none; }
        canvas { display: block; width: 100%; height: 100%; }
        .clear-sig { position: absolute; top: 5px; right: 5px; background: #fff; border: 1px solid red; color: red; font-size: 10px; padding: 2px 8px; cursor: pointer; }

        /* Bot√µes */
        .actions { margin-top: 30px; display: grid; grid-template-columns: 2fr 1fr; gap: 15px; }
        .btn { padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; text-transform: uppercase; color: white; }
        .btn-save { background: var(--primary); }
        .btn-clear { background: white; color: red; border: 1px solid red; }

        /* Auto Save Status */
        #status-save { position: fixed; top: 10px; right: 10px; background: var(--success); color: white; padding: 5px 10px; border-radius: 20px; font-size: 10px; opacity: 0; transition: opacity 0.5s; }

        @media print {
            .actions, .clear-sig, #status-save { display: none; }
            .container { box-shadow: none; border: none; width: 100%; max-width: 100%; }
        }
    </style>
</head>
<body>

    <div id="status-save">üíæ Salvo</div>

    <div class="container" id="conteudo-vistoria">
        <!-- HEADER -->
        <div class="header">
            <!-- Se a imagem n√£o carregar, ela some sem quebrar o layout -->
            <img src="logo.png" class="logo-img" alt="Logo Porto Mais" onerror="this.style.display='none'"> 
            <div class="header-subtitle">VISTORIA E RECEBIMENTO DE VE√çCULO</div>
        </div>

        <!-- INFO -->
        <div class="info-header">
            <div class="info-item"><label>Data</label><input type="date" id="data_entrada"></div>
            <div class="info-item"><label>Hora</label><input type="time" id="hora_entrada"></div>
            <div class="info-item"><label>N¬∫ Evento</label><input type="text" id="n_sinistro" placeholder="0000"></div>
        </div>

        <!-- OFICINA -->
        <div class="section">
            <div class="section-title">üìç OFICINA</div>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group"><label>Nome da Oficina</label><input type="text" id="oficina_nome"></div>
                    <div class="form-group"><label>Consultor</label><input type="text" id="consultor_nome"></div>
                </div>
            </div>
        </div>

        <!-- CLIENTE -->
        <div class="section">
            <div class="section-title">üë§ CLIENTE</div>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group"><label>Tipo</label><select id="tipo_cliente"><option>Associado</option><option>Terceiro</option></select></div>
                    <div class="form-group"><label>Nome</label><input type="text" id="nome_cliente"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>CPF/CNPJ</label><input type="text" id="cpf_cliente" oninput="maskCPF(this)" maxlength="18"></div>
                    <div class="form-group"><label>Telefone</label><input type="text" id="tel_cliente" oninput="maskPhone(this)" maxlength="15"></div>
                </div>
            </div>
        </div>

        <!-- VEICULO -->
        <div class="section">
            <div class="section-title">üöó VE√çCULO</div>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group"><label>Modelo</label><input type="text" id="modelo_veic"></div>
                    <div class="form-group"><label>Placa</label><input type="text" id="placa_veiculo" oninput="maskPlaca(this)" maxlength="8"></div>
                    <div class="form-group"><label>Cor</label><input type="text" id="cor_veic"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Combust√≠vel</label><select id="combustivel_veic"><option>Reserva</option><option>1/4</option><option>1/2</option><option>3/4</option><option>Cheio</option></select></div>
                    <div class="form-group"><label>KM</label><input type="number" id="km_veic"></div>
                </div>
            </div>
        </div>

        <!-- CHECKLIST -->
        <div class="section">
            <div class="section-title">‚úÖ CHECKLIST</div>
            <div class="section-content">
                <div class="checkbox-grid">
                    <label class="checkbox-item"><input type="checkbox" id="chk_chave_roda"> Chave Roda</label>
                    <label class="checkbox-item"><input type="checkbox" id="chk_macaco"> Macaco</label>
                    <label class="checkbox-item"><input type="checkbox" id="chk_triangulo"> Tri√¢ngulo</label>
                    <label class="checkbox-item"><input type="checkbox" id="chk_estepe"> Estepe</label>
                    <label class="checkbox-item"><input type="checkbox" id="chk_manual"> Manual</label>
                    <label class="checkbox-item"><input type="checkbox" id="chk_som"> Multim√≠dia</label>
                </div>
                <div class="form-group" style="margin-top:10px"><label>Obs. Pertences</label><input type="text" id="obs_pertences"></div>
            </div>
        </div>

        <!-- AVARIAS -->
        <div class="section">
            <div class="section-title">‚ö†Ô∏è AVARIAS</div>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group"><label>Frente</label><input type="text" id="avaria_frente"></div>
                    <div class="form-group"><label>Traseira</label><input type="text" id="avaria_traseira"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Lat. Esq</label><input type="text" id="avaria_esq"></div>
                    <div class="form-group"><label>Lat. Dir</label><input type="text" id="avaria_dir"></div>
                </div>
            </div>
        </div>

        <!-- ASSINATURAS -->
        <div class="section">
            <div class="section-title">‚úçÔ∏è ASSINATURAS</div>
            <div class="section-content">
                <div class="form-row">
                    <div class="form-group">
                        <label>Respons√°vel Porto Mais</label>
                        <div class="signature-wrapper"><canvas id="sig-resp"></canvas><button class="clear-sig" onclick="clearSig('sig-resp')">X</button></div>
                    </div>
                    <div class="form-group">
                        <label>Cliente</label>
                        <div class="signature-wrapper"><canvas id="sig-cli"></canvas><button class="clear-sig" onclick="clearSig('sig-cli')">X</button></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- BOTOES -->
        <div class="actions" data-html2canvas-ignore="true">
            <button class="btn btn-save" onclick="baixarPDF()">üíæ SALVAR PDF</button>
            <button class="btn btn-clear" onclick="limparTudo()">üóëÔ∏è LIMPAR</button>
        </div>
    </div>

    <!-- CARREGAR BIBLIOTECA NO FINAL PARA N√ÉO TRAVAR A TELA -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        // --- INICIALIZA√á√ÉO ---
        document.addEventListener("DOMContentLoaded", () => {
            // Data Autom√°tica
            if(!localStorage.getItem('checklist_data_entrada')) {
                const now = new Date();
                document.getElementById('data_entrada').valueAsDate = now;
                document.getElementById('hora_entrada').value = now.toTimeString().substring(0,5);
            }
            
            // Assinaturas
            initSig('sig-resp');
            initSig('sig-cli');
            
            // Carregar dados salvos
            loadData();
            
            // Ativar Auto-Save
            document.querySelectorAll('input, select').forEach(el => {
                el.addEventListener('input', (e) => {
                    if(e.target.type==='text') e.target.value = e.target.value.toUpperCase();
                    saveData(e.target);
                });
            });
        });

        // --- SISTEMA DE ASSINATURA ---
        function initSig(id) {
            const c = document.getElementById(id);
            const ctx = c.getContext('2d');
            let drawing = false;

            function resize() {
                const rect = c.getBoundingClientRect();
                c.width = rect.width; c.height = rect.height;
                ctx.lineWidth = 2; ctx.strokeStyle = "#001a4d";
            }
            window.addEventListener('resize', resize);
            resize(); // Chama ao iniciar

            function getPos(e) {
                const rect = c.getBoundingClientRect();
                const x = e.touches ? e.touches[0].clientX : e.clientX;
                const y = e.touches ? e.touches[0].clientY : e.clientY;
                return { x: x - rect.left, y: y - rect.top };
            }

            const start = (e) => { drawing=true; ctx.beginPath(); ctx.moveTo(getPos(e).x, getPos(e).y); e.preventDefault(); };
            const end = () => drawing=false;
            const move = (e) => { if(!drawing)return; ctx.lineTo(getPos(e).x, getPos(e).y); ctx.stroke(); e.preventDefault(); };

            c.addEventListener('mousedown', start); c.addEventListener('touchstart', start, {passive:false});
            c.addEventListener('mouseup', end); c.addEventListener('touchend', end);
            c.addEventListener('mousemove', move); c.addEventListener('touchmove', move, {passive:false});
        }
        function clearSig(id) {
            const c = document.getElementById(id);
            c.getContext('2d').clearRect(0,0,c.width,c.height);
        }

        // --- SALVAMENTO LOCAL ---
        function saveData(el) {
            let val = el.type==='checkbox' ? el.checked : el.value;
            localStorage.setItem('checklist_'+el.id, val);
            const s = document.getElementById('status-save');
            s.style.opacity=1; setTimeout(()=>s.style.opacity=0, 1000);
        }
        function loadData() {
            document.querySelectorAll('input, select').forEach(el => {
                const val = localStorage.getItem('checklist_'+el.id);
                if(val !== null) {
                    if(el.type==='checkbox') el.checked = (val==='true');
                    else el.value = val;
                }
            });
        }
        function limparTudo() {
            if(confirm("Apagar tudo?")) {
                localStorage.clear();
                location.reload();
            }
        }

        // --- PDF ---
        function baixarPDF() {
            const el = document.getElementById('conteudo-vistoria');
            const placa = document.getElementById('placa_veiculo').value || "SEM_PLACA";
            const btn = document.querySelector('.btn-save');
            
            // Verifica se a biblioteca carregou
            if(typeof html2pdf === 'undefined') {
                alert("Erro: Biblioteca PDF n√£o carregou. Verifique sua internet.");
                return;
            }

            btn.innerText = "‚è≥ GERANDO...";
            const opt = {
                margin: 0.2, filename: `Checklist_${placa}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(el).save().then(() => {
                btn.innerText = "‚úÖ SALVO!";
                setTimeout(()=>btn.innerText="üíæ SALVAR PDF", 2000);
            });
        }

        // --- M√ÅSCARAS SIMPLES ---
        function maskCPF(i){ i.value=i.value.replace(/\D/g,"").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d)/,"$1.$2").replace(/(\d{3})(\d{1,2})$/,"$1-$2"); }
        function maskPhone(i){ i.value=i.value.replace(/\D/g,"").replace(/^(\d{2})(\d)/g,"($1) $2").replace(/(\d)(\d{4})$/,"$1-$2"); }
        function maskPlaca(i){ i.value=i.value.toUpperCase().replace(/[^A-Z0-9]/g,""); }
    </script>
</body>
</html>
